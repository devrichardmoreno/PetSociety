<div class="modal-header-wrapper">
    @if (petInfo) {
        <div class="pet-header">
            <h2 class="modal-title">Historia cl√≠nica</h2>
            <div class="pet-info-card">
                <div class="pet-main-info">
                    <h3 class="pet-name">{{ getFullPetDisplay(petInfo) }}</h3>
                    @if (petInfo.clientName) {
                        <p class="pet-owner">Due√±o: {{ petInfo.clientName }}</p>
                    }
                </div>
            </div>
        </div>
    } @else {
        <h2 class="modal-title">Historia cl√≠nica</h2>
    }
    <button class="close-button" (click)="close()" aria-label="Cerrar modal" type="button">
        <span class="close-icon">√ó</span>
    </button>
</div>

@if (loadingDiagnoses) {
    <div class="loading">Cargando diagn√≥sticos...</div>
}

@if (diagnosesError) {
    <div class="error">Error al cargar los diagn√≥sticos: {{ diagnosesError }}</div>
}

@if (!loadingDiagnoses && !diagnosesError && lastestDiagnoses.length > 0) {
    <ul class="diagnoses-list" role="list">
        @for (diagnose of lastestDiagnoses; track $index) {
            <li class="diagnose-item" role="listitem" aria-label="Diagn√≥stico {{ $index + 1 }}">
                <div class="diagnose-header">
                    <div class="diagnose-doctor-info">
                        <span class="doctor-label">Atendido por:</span>
                        <span class="doctor-name">{{ diagnose.doctorName || '‚Äî' }}</span>
                    </div>
                    <span class="diagnose-date">{{ diagnose.date | date:'dd/MM/yyyy HH:mm' }}</span>
                </div>
                <div class="diagnose-body">
                    <p class="diagnose-summary"><strong>Diagn√≥stico:</strong> {{ diagnose.diagnose || 'Sin diagn√≥stico' }}</p>
                    <p class="diagnose-summary"><strong>Tratamiento:</strong> {{ diagnose.treatment || 'Sin tratamiento' }}</p>
                </div>
            </li>
        }
    </ul>

    @if (diagnosesPage.totalPages > 1) {
        <div class="pagination-controls">
            @if (diagnosesPage.page > 0) {
                <button 
                    mat-raised-button
                    color="primary"
                    (click)="prevPage()"
                    [disabled]="loadingDiagnoses"
                    class="pagination-btn">
                    ‚óÄ Anterior
                </button>
            }
            
            <span class="page-info">P√°gina {{ diagnosesPage.page + 1 }} de {{ diagnosesPage.totalPages }}</span>

            @if (diagnosesPage.page + 1 < diagnosesPage.totalPages) {
                <button 
                    mat-raised-button
                    color="primary"
                    (click)="nextPage()"
                    [disabled]="loadingDiagnoses"
                    class="pagination-btn">
                    Siguiente ‚ñ∂
                </button>
            }
        </div>
    }

} @else if (!loadingDiagnoses && !diagnosesError && lastestDiagnoses.length === 0) {
    <div class="empty-state">
        <div class="empty-state-icon">üìã</div>
        <h3 class="empty-state-title">Sin diagn√≥sticos registrados</h3>
        <p class="empty-state-message">Esta mascota a√∫n no tiene diagn√≥sticos en su historia cl√≠nica.</p>
    </div>
}
