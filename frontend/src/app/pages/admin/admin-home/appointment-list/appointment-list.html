<section id="appointment-container-all">
  <div class="table-container">
    <h1>Lista de Citas</h1>

    <div class="search-container">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="filterAppointments()"
        placeholder="Buscar por doctor, mascota, razón o estado"
        class="search-input"
      />
      <input
        type="date"
        [(ngModel)]="searchDate"
        (change)="filterAppointments()"
        class="date-input"
      />
      <select [(ngModel)]="selectedDoctor" (change)="filterAppointments()" class="filter-select">
        <option value="">Todos los doctores</option>
        <option *ngFor="let doctor of doctors" [value]="doctor">{{ doctor }}</option>
      </select>
      <select [(ngModel)]="selectedStatus" (change)="filterAppointments()" class="filter-select">
        <option value="">Todos los estados</option>
        <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
      </select>
      <select [(ngModel)]="selectedReason" (change)="filterAppointments()" class="filter-select">
        <option value="">Todas las razones</option>
        <option *ngFor="let reason of reasons" [value]="reason">{{ reason }}</option>
      </select>
    </div>

    <div class="loading-msg" [hidden]="!loading">Cargando citas...</div>

    <div class="error-msg" [hidden]="!error">{{ error }}</div>

    <table class="appointment-table" [hidden]="loading || filteredAppointments.length === 0">
      <thead>
        <tr>
          <th>Doctor</th>
          <th>Mascota</th>
          <th>Razón</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>Aprobado</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let appt of filteredAppointments">
          <td>{{ appt.doctorName }}</td>
          <td>{{ appt.petName }}</td>
          <td>{{ appt.reason }}</td>
          <td>{{ appt.startTime | date:'short' }}</td>
          <td>{{ appt.endTime | date:'short' }}</td>
          <td>
            <span [ngClass]="appt.aproved ? 'approved' : 'not-approved'">
              {{ appt.aproved ? 'Sí' : 'No' }}
            </span>
          </td>
          <td>{{ appt.status }}</td>
        </tr>
      </tbody>
    </table>

    <div class="no-data-msg" [hidden]="loading || filteredAppointments.length > 0">
      No hay citas para mostrar.
    </div>
  </div>
</section>
